<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Kerberos Unconstrained Delegation Setup</title>
</head><body>Kerberos Unconstrained Delegation Setup <br/>
For this scenario, let’s assume that we have unprivileged access on a random Windows domain system and have also compromised an SeEnableDelegationPrivilege account.<br/>
&nbsp;<br/>
<br/>
Here are the steps to setup the attack:<ul><li>Use the SeEnableDelegationPrivilege account to add a machine account through MAQ.<img src="https://blog.netspi.com/wp-content/uploads/2019/03/MAQLDAPAdd3.png" width="855" height="72" /></li>
</ul>
<img src="image.png" /><ul><li>Enable unconstrained delegation by setting the userAccountControl attribute to 528384.<img src="https://blog.netspi.com/wp-content/uploads/2019/03/MAQDelegation3.png" width="856" height="75" /></li>
</ul>
<img src="image 2.png" /><ul><li>Optionally, set the msDS-SupportedEncryptionTypes attribute to set the desired Kerberos encryption type using the machine account’s credentials.<img src="https://blog.netspi.com/wp-content/uploads/2019/03/MAQEncryption.png" width="856" height="72" /></li>
</ul>
<img src="image 3.png" /><ul><li>Optionally, add a corresponding DNS record matching the SPNs and pointing to the compromised Windows system. This can usually be done with through either <a href="https://blog.netspi.com/exploiting-adidns/">dynamic updates or LDAP</a>. This is optional since with the default SPNs, Kerberos will can also trigger from other name resolution methods such as LLMNR/NBNS.</li>
</ul>
&nbsp;<img src="image 4.png" /><br/>
<br/>
<br/>
</body></html>