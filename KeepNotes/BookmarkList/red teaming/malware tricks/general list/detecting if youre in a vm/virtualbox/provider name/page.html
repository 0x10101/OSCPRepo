<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Provider Name</title>
</head><body>//http://waleedassar.blogspot.com/ &nbsp; (@waleedassar)<br/>
//Using the "WNetGetProviderName" function to detect VirtualBox.<br/>
//Thanks @deesse_k for the idea<br/>
<br/>
#include "stdafx.h"<br/>
#include "windows.h"<br/>
#include "Winnetwk.h"<br/>
<br/>
#pragma comment(lib,"MPR")<br/>
<br/>
int main(void)<br/>
{<br/>
&#09; &nbsp; //method 9<br/>
&nbsp; &nbsp; &nbsp; &nbsp;unsigned long pnsize=0x1000;<br/>
&nbsp; &nbsp; &nbsp; &nbsp;char* provider=(char*)LocalAlloc(LMEM_ZEROINIT,pnsize);<br/>
&nbsp; &nbsp; &nbsp; &nbsp;int retv=WNetGetProviderName(WNNC_NET_RDR2SAMPLE,provider,&amp;pnsize);<br/>
&nbsp; &nbsp; &nbsp; &nbsp;if(retv==NO_ERROR)<br/>
&nbsp; &nbsp; &nbsp; &nbsp;{<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(lstrcmpi(provider,"VirtualBox Shared Folders")==0)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MessageBox(0,"VirtualBox detected","waliedassar",0);<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ExitProcess(9);<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; &nbsp; &nbsp;}<br/>
&nbsp; &nbsp; &nbsp; &nbsp;return 0;<br/>
}</body></html>