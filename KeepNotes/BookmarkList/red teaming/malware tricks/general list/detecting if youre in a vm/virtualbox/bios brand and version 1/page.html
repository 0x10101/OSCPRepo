<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Bios Brand and Version 1</title>
</head><body>//http://waleedassar.blogspot.com (@waleedassar)<br/>
//Reading "SMBiosData" to extract Bios Brand and Bios Version strings from registry.<br/>
//If the Bios Brand string is "innotek GmbH" or Bios Version is "VirtualBox", then it is a sign that we are running in VirtualBox.<br/>
//You can also use WMI to extract the same info.<br/>
#include "stdafx.h"<br/>
#include "windows.h"<br/>
#include "stdio.h"<br/>
<br/>
<br/>
void AllToUpper(char* str,unsigned long len)<br/>
{<br/>
&#09;for(unsigned long c=0;c&lt;len;c++)<br/>
&#09;{<br/>
&#09;&#09;if(str[c]&gt;='a' &amp;&amp; str[c]&lt;='z')<br/>
&#09;&#09;{<br/>
&#09;&#09;&#09;str[c]-=32;<br/>
&#09;&#09;}<br/>
&#09;}<br/>
}<br/>
<br/>
unsigned char* ScanDataForString(unsigned char* data,unsigned long data_length,unsigned char* string2)<br/>
{<br/>
&#09;unsigned long string_length=strlen((char*)string2);<br/>
&#09;for(unsigned long i=0;i&lt;=(data_length-string_length);i++)<br/>
&#09;{<br/>
&#09;&#09;if(strncmp((char*)(&amp;data[i]),(char*)string2,string_length)==0) return &amp;data[i];<br/>
&#09;}<br/>
&#09;return 0;<br/>
}<br/>
<br/>
int main(int argc, char* argv[])<br/>
{<br/>
&#09;HKEY hk=0;<br/>
&#09;int ret=RegOpenKeyEx(HKEY_LOCAL_MACHINE,"SYSTEM\\CurrentControlSet\\Services\\mssmbios\\data",0,KEY_ALL_ACCESS,&amp;hk);<br/>
&#09;if(ret==ERROR_SUCCESS)<br/>
&#09;{<br/>
&#09;&#09;unsigned long type=0;<br/>
&#09;&#09;unsigned long length=0;<br/>
&#09;&#09;ret=RegQueryValueEx(hk,"SMBiosData",0,&amp;type,0,&amp;length);<br/>
&#09;&#09;if(ret==ERROR_SUCCESS)<br/>
&#09;&#09;{<br/>
&#09;&#09;&#09;if(length)<br/>
&#09;&#09;&#09;{<br/>
&#09;&#09;&#09;&#09;char* p=(char*)LocalAlloc(LMEM_ZEROINIT,length);<br/>
&#09;&#09;&#09;&#09;if(p)<br/>
&#09;&#09;&#09;&#09;{<br/>
&#09;&#09;&#09;&#09;&#09;ret=RegQueryValueEx(hk,"SMBiosData",0,&amp;type,(unsigned char*)p,&amp;length);<br/>
&#09;&#09;&#09;&#09;&#09;if(ret==ERROR_SUCCESS)<br/>
&#09;&#09;&#09;&#09;&#09;{<br/>
&#09;&#09;&#09;&#09;&#09; &nbsp; &nbsp; &nbsp;AllToUpper(p,length);<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;unsigned char* x1=ScanDataForString((unsigned char*)p,length,(unsigned char*)"INNOTEK GMBH");<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;unsigned char* x2=ScanDataForString((unsigned char*)p,length,(unsigned char*)"VIRTUALBOX");<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;unsigned char* x3=ScanDataForString((unsigned char*)p,length,(unsigned char*)"SUN MICROSYSTEMS");<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;unsigned char* x4=ScanDataForString((unsigned char*)p,length,(unsigned char*)"VIRTUAL MACHINE");<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;unsigned char* x5=ScanDataForString((unsigned char*)p,length,(unsigned char*)"VBOXVER");<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;if(x1 || x2 || x3 || x4 || x5)<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;{<br/>
&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;printf("VirtualBox detected\r\n");<br/>
&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;printf("Some Strings found:\r\n");<br/>
&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;if(x1) printf("%s\r\n",x1);<br/>
&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;if(x2) printf("%s\r\n",x2);<br/>
&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;if(x3) printf("%s\r\n",x3);<br/>
&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;if(x4) printf("%s\r\n",x4);<br/>
&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;if(x5) printf("%s\r\n",x5);<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp;}<br/>
&#09;&#09;&#09;&#09;&#09;}<br/>
&#09;&#09;&#09;&#09;&#09;LocalFree(p);<br/>
&#09;&#09;&#09;&#09;}<br/>
&#09;&#09;&#09;}<br/>
&#09;&#09;}<br/>
&#09;&#09;RegCloseKey(hk);<br/>
&#09;}<br/>
&#09;return 0;<br/>
}</body></html>