<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Innotek Trick</title>
</head><body>//http://waleedassar.blogspot.com (@waleedassar)<br/>
//MS VC++ 2005 + DirectX SDK<br/>
#include "stdafx.h"<br/>
#include "dxdiag.h"<br/>
#include "stdio.h"<br/>
<br/>
int main(int argc, _TCHAR* argv[])<br/>
{<br/>
&nbsp; &nbsp; HRESULT hr=CoInitialize(0);<br/>
&#09;if(!SUCCEEDED(hr)) return 0;<br/>
&#09;IDxDiagProvider* pProvider = NULL;<br/>
&nbsp; &nbsp; hr=CoCreateInstance(CLSID_DxDiagProvider,0,CLSCTX_INPROC_SERVER,IID_IDxDiagProvider,(void**)&amp;pProvider );<br/>
&#09;if(!SUCCEEDED(hr))<br/>
&#09;{<br/>
&#09;&#09;CoUninitialize();<br/>
&#09;&#09;return 0;<br/>
&#09;}<br/>
&#09;DXDIAG_INIT_PARAMS InitParams={0};<br/>
&#09;InitParams.dwSize=sizeof(DXDIAG_INIT_PARAMS);<br/>
&#09;InitParams.dwDxDiagHeaderVersion=DXDIAG_DX9_SDK_VERSION;<br/>
&#09;InitParams.bAllowWHQLChecks=false;<br/>
&nbsp; &nbsp; hr=pProvider-&gt;Initialize(&amp;InitParams);<br/>
&nbsp; &nbsp; if(SUCCEEDED(hr))<br/>
&#09;{<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IDxDiagContainer* pDxDiagRoot=0;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IDxDiagContainer* pDxDiagSystemInfo=0;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hr=pProvider-&gt;GetRootContainer(&amp;pDxDiagRoot );<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(SUCCEEDED(hr)) <br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hr=pDxDiagRoot-&gt;GetChildContainer( L"DxDiag_SystemInfo", &amp;pDxDiagSystemInfo );<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(SUCCEEDED(hr) )<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VARIANT varX;<br/>
&#09;&#09;&#09;&#09;&#09; &nbsp; hr=pDxDiagSystemInfo-&gt;GetProp( L"szSystemManufacturerEnglish",&amp;varX);<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if( SUCCEEDED(hr)&amp;&amp;varX.vt==VT_BSTR &amp;&amp; SysStringLen(varX.bstrVal)!=0)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; wchar_t* pMan=varX.bstrVal;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wprintf(L"System Manufacturer is %s\r\n",pMan);<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; if(!_wcsicmp(pMan,L"innotek GmbH"))<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; {<br/>
&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; printf("VirtualBox detected\r\n");<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; }<br/>
&#09;&#09;&#09;&#09; &nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VariantClear(&amp;varX);<br/>
&#09;&#09;&#09;&#09;&#09; &nbsp; hr=pDxDiagSystemInfo-&gt;GetProp( L"szSystemModelEnglish",&amp;varX);<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if( SUCCEEDED(hr)&amp;&amp;varX.vt==VT_BSTR &amp;&amp; SysStringLen(varX.bstrVal)!=0)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; wchar_t* pMan=varX.bstrVal;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;wprintf(L"System Model is %s\r\n",pMan);<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; if(!_wcsicmp(pMan,L"VirtualBox"))<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; {<br/>
&#09;&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; printf("VirtualBox detected\r\n");<br/>
&#09;&#09;&#09;&#09;&#09;&#09; &nbsp; }<br/>
&#09;&#09;&#09;&#09; &nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;VariantClear(&amp;varX);<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;pDxDiagSystemInfo-&gt;Release();<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pDxDiagRoot-&gt;Release();<br/>
&nbsp; &nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; &nbsp; &nbsp; //pProvider-&gt;Release();<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; CoUninitialize();<br/>
&#09;return 0;<br/>
}</body></html>